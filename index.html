<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gaussian Log → Com 変換</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, 'Helvetica Neue', sans-serif;
    background: linear-gradient(135deg, #fdf6e3 0%, #fff8ec 50%, #f0e6ff 100%);
    color: #333;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
  }
  h1 {
    font-size: 1.5em;
    font-weight: 700;
    margin-bottom: 8px;
    background: linear-gradient(90deg, #7c3aed, #f59e0b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .subtitle { font-size: 0.85em; color: #999; margin-bottom: 28px; }
  .card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    padding: 28px;
    width: 100%;
    max-width: 1000px;
    margin-bottom: 20px;
  }
  #input.dragover { border-color: #7c3aed; background: #faf5ff; box-shadow: 0 0 0 3px rgba(124,58,237,0.12); }
  .container { display: flex; gap: 16px; }
  .panel { flex: 1; display: flex; flex-direction: column; }
  .panel label {
    font-size: 0.75em;
    font-weight: 600;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 6px;
  }
  textarea {
    width: 100%;
    height: 360px;
    background: #fafafa;
    color: #333;
    border: 1px solid #e5e5e5;
    border-radius: 10px;
    padding: 14px;
    font-family: 'Menlo', 'SF Mono', 'Courier New', monospace;
    font-size: 12px;
    line-height: 1.5;
    resize: vertical;
    transition: border-color 0.2s;
  }
  textarea:focus { outline: none; border-color: #c4b5fd; box-shadow: 0 0 0 3px rgba(124,58,237,0.08); }
  textarea[readonly] { background: #f5f5f5; }
  .buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    justify-content: center;
  }
  button {
    padding: 10px 32px;
    border: none;
    border-radius: 50px;
    font-size: 0.9em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  #convertBtn {
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    color: #fff;
    box-shadow: 0 2px 12px rgba(124,58,237,0.25);
  }
  #convertBtn:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(124,58,237,0.35); }
  #copyBtn, #downloadBtn {
    background: #f3f4f6;
    color: #555;
  }
  #copyBtn:hover, #downloadBtn:hover { background: #e5e7eb; }
  .msg {
    font-size: 0.8em;
    color: #7c3aed;
    margin-top: 12px;
    text-align: center;
    min-height: 1.2em;
  }
  .arrow { display: none; }
  @media (max-width: 700px) {
    .container { flex-direction: column; }
    textarea { height: 250px; }
  }
</style>
</head>
<body>

<h1>Gaussian Log to Com</h1>
<p class="subtitle">.log / .com ファイルから元素記号付き座標に変換</p>

<div class="card">
  <div class="container">
    <div class="panel">
      <label>Input</label>
      <textarea id="input" placeholder="ペースト or .log / .com ファイルをここにドロップ&#10;&#10;対応形式:&#10;  6列 (log):  1  6  0  -1.179  2.621  1.114&#10;  4列 (com):  6  -1.179  2.621  1.114"></textarea>
    </div>
    <div class="panel">
      <label>Output</label>
      <textarea id="output" readonly placeholder="変換ボタンを押すと結果が表示されます"></textarea>
    </div>
  </div>

  <div class="buttons">
    <button id="convertBtn">変換</button>
    <button id="copyBtn">コピー</button>
    <button id="downloadBtn">ダウンロード</button>
  </div>
  <div class="msg" id="msg"></div>
</div>

<script>
const SYMBOLS = {
  1:'H',2:'He',3:'Li',4:'Be',5:'B',6:'C',7:'N',8:'O',9:'F',10:'Ne',
  11:'Na',12:'Mg',13:'Al',14:'Si',15:'P',16:'S',17:'Cl',18:'Ar',19:'K',20:'Ca',
  21:'Sc',22:'Ti',23:'V',24:'Cr',25:'Mn',26:'Fe',27:'Co',28:'Ni',29:'Cu',30:'Zn',
  31:'Ga',32:'Ge',33:'As',34:'Se',35:'Br',36:'Kr',37:'Rb',38:'Sr',39:'Y',40:'Zr',
  41:'Nb',42:'Mo',43:'Tc',44:'Ru',45:'Rh',46:'Pd',47:'Ag',48:'Cd',49:'In',50:'Sn',
  51:'Sb',52:'Te',53:'I',54:'Xe',55:'Cs',56:'Ba',57:'La',72:'Hf',73:'Ta',74:'W',
  75:'Re',76:'Os',77:'Ir',78:'Pt',79:'Au',80:'Hg',81:'Tl',82:'Pb',83:'Bi',86:'Rn'
};

function convert(text) {
  return text.split('\n').map(line => {
    const trimmed = line.trim();
    if (!trimmed) return '';
    const parts = trimmed.split(/\s+/);
    let num, x, y, z;
    if (parts.length === 6) {
      num = parseInt(parts[1], 10);
      [x, y, z] = [parts[3], parts[4], parts[5]];
    } else if (parts.length === 4) {
      num = parseInt(parts[0], 10);
      [x, y, z] = [parts[1], parts[2], parts[3]];
    } else {
      return line;
    }
    if (isNaN(num)) return line;
    const sym = SYMBOLS[num];
    if (!sym) return line;
    return ` ${sym.padEnd(2)}     ${x.padStart(12)}   ${y.padStart(12)}   ${z.padStart(12)}`;
  }).join('\n');
}

function extractLastInputOrientation(text) {
  const lines = text.split('\n');
  let lastIdx = -1;
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].includes('Input orientation:')) lastIdx = i;
  }
  if (lastIdx === -1) return null;
  const dataLines = [];
  for (let i = lastIdx + 5; i < lines.length; i++) {
    if (lines[i].trim().startsWith('---')) break;
    dataLines.push(lines[i]);
  }
  return dataLines.join('\n');
}

document.getElementById('convertBtn').addEventListener('click', () => {
  const input = document.getElementById('input').value;
  if (!input.trim()) { showMsg('入力が空です'); return; }
  document.getElementById('output').value = convert(input);
  showMsg('変換しました');
});

document.getElementById('copyBtn').addEventListener('click', () => {
  const output = document.getElementById('output');
  if (!output.value) { showMsg('出力が空です'); return; }
  navigator.clipboard.writeText(output.value).then(() => showMsg('コピーしました'));
});

document.getElementById('downloadBtn').addEventListener('click', () => {
  const output = document.getElementById('output').value;
  if (!output) { showMsg('出力が空です'); return; }
  const blob = new Blob([output], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'converted.com';
  a.click();
  URL.revokeObjectURL(a.href);
  showMsg('ダウンロードしました');
});

const inputArea = document.getElementById('input');

inputArea.addEventListener('dragover', e => { e.preventDefault(); inputArea.classList.add('dragover'); });
inputArea.addEventListener('dragleave', () => inputArea.classList.remove('dragover'));
inputArea.addEventListener('drop', e => {
  e.preventDefault();
  inputArea.classList.remove('dragover');
  if (e.dataTransfer.files.length) handleFiles(e.dataTransfer.files);
});

function handleFiles(files) {
  if (!files.length) return;
  const reader = new FileReader();
  reader.onload = e => {
    const content = e.target.result;
    const isLog = files[0].name.endsWith('.log');
    let inputText;
    if (isLog) {
      inputText = extractLastInputOrientation(content);
      if (!inputText) { showMsg('Input orientation が見つかりません'); return; }
    } else {
      inputText = content;
    }
    document.getElementById('input').value = inputText;
    document.getElementById('output').value = '';
    showMsg(`${files[0].name} を読み込みました — 変換ボタンを押してください`);
  };
  reader.readAsText(files[0]);
}

function showMsg(text) {
  const el = document.getElementById('msg');
  el.textContent = text;
  setTimeout(() => el.textContent = '', 4000);
}
</script>
</body>
</html>
